<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ | Full Mark</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: #fff; font-family: 'Cairo'; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: #111; padding: 20px; border-radius: 15px; border: 1px solid #333; }
        h2 { text-align: center; color: #00e1ff; margin-bottom: 20px; }
        
        label { display: block; margin-top: 10px; color: #aaa; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; outline: none; }
        input:focus { border-color: #00e1ff; }
        
        button { width: 100%; padding: 15px; margin-top: 20px; background: #00e1ff; color: #000; border: none; font-weight: bold; border-radius: 5px; cursor: pointer; font-size: 1.1rem; }
        button:hover { background: #fff; }

        .msg { text-align: center; margin-top: 15px; font-weight: bold; }
        .success { color: #00ff88; }
        .error { color: #ff3333; }
    </style>
</head>
<body>

    <div class="container">
        <h2>ğŸ¥ Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
        
        <label>1. Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
        <input type="text" id="subName" list="subList" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">
        <datalist id="subList">
            <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">
            <option value="Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">
            <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">
            <option value="Ø§Ù„Ø£Ø­ÙŠØ§Ø¡">
        </datalist>

        <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¯Ø© (Ø±Ø§Ø¨Ø·)</label>
        <input type="text" id="subImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø§Ø¯Ø©">

        <label>2. Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³</label>
        <input type="text" id="techName" placeholder="Ù…Ø«Ø§Ù„: Ø£. Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø¬ÙˆØ§Ø¯">
        
        <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³ (Ø±Ø§Ø¨Ø·)</label>
        <input type="text" id="techImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³">

        <label>3. Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³ / Ø§Ù„ÙØµÙ„</label>
        <input type="text" id="courseName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„Ø£ÙˆÙ„ - Ø£Ùˆ - Ù…Ø³Ø£Ù„ØªÙŠÙ† ÙƒÙ„ ÙŠÙˆÙ…">

        <label>4. Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</label>
        <input type="text" id="vidName" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰">

        <label>5. Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (m3u8)</label>
        <input type="text" id="vidLink" placeholder="https://...">

        <button onclick="addVideo()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù…Ù†ØµØ©</button>
        <div id="msg" class="msg"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyBKY38XHjmC-iGqGrQio_YZ_i1iaIaE2Ds", authDomain: "full-mark-8d434.firebaseapp.com", projectId: "full-mark-8d434", storageBucket: "full-mark-8d434.firebasestorage.app", messagingSenderId: "802579483999", appId: "1:802579483999:web:cf73136ffbd75d5e0ebaea" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

        async function addVideo() {
            const btn = document.querySelector('button');
            const msg = document.getElementById('msg');
            
            const subName = document.getElementById('subName').value.trim();
            const subImg = document.getElementById('subImg').value.trim() || 'https://cdn-icons-png.flaticon.com/512/2997/2997380.png';
            const techName = document.getElementById('techName').value.trim();
            const techImg = document.getElementById('techImg').value.trim() || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
            const courseName = document.getElementById('courseName').value.trim();
            const vidName = document.getElementById('vidName').value.trim();
            const vidLink = document.getElementById('vidLink').value.trim();

            if(!subName || !techName || !courseName || !vidName || !vidLink) {
                msg.className = 'msg error'; msg.innerText = "ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©!"; return;
            }

            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©...";

            try {
                // 1. Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø§Ø¯Ø©
                const subRef = db.collection('subjects').doc(subName);
                const doc = await subRef.get();
                let data = doc.exists ? doc.data() : { name: subName, img: subImg, teachers: [] };

                // 2. Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¯Ø±Ø³
                let teacher = data.teachers.find(t => t.name === techName);
                if (!teacher) {
                    teacher = { name: techName, img: techImg, courses: [] };
                    data.teachers.push(teacher);
                }

                // 3. Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙˆØ±Ø³
                let course = teacher.courses.find(c => c.name === courseName);
                if (!course) {
                    course = { name: courseName, videos: [] };
                    teacher.courses.push(course);
                }

                // 4. Ù†Ø¶ÙŠÙ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                course.videos.push({ name: vidName, link: vidLink });

                // 5. Ø­ÙØ¸ ÙÙŠ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ²
                await subRef.set(data);

                msg.className = 'msg success'; msg.innerText = "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù†Ø²Ù„ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©.";
                // ØªÙ†Ø¸ÙŠÙ Ø®Ø§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙ‚Ø· Ø¹Ø´Ø§Ù† Ù„Ùˆ Ù‡ØªØ¶ÙŠÙ ÙÙŠØ¯ÙŠÙˆ ØªØ§Ù†ÙŠ Ù„Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ±Ø³
                document.getElementById('vidName').value = '';
                document.getElementById('vidLink').value = '';

            } catch (err) {
                console.error(err);
                msg.className = 'msg error'; msg.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message;
            }
            btn.disabled = false; btn.innerText = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù…Ù†ØµØ©";
        }
    </script>
</body>
</html>
